{% extends 'admin/dashboard_base.html' %}

{% block title %} Ad Requests {% endblock %}
{% block nav_title %} Ad Requests {% endblock %}

{% block content %}
<div class="main">
    <div class="container mt-2">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <div class="section1">
            <div class="box1 box" style="width: 230px;">
                <div class="d-flex align-items-center" style="margin-bottom: 0%;">
                    <img src="/static/img/ad-request.svg" alt="Ad Request" style="height: 40px; margin-right: 10px;">
                    <div class="ml-3 flex-grow-1">
                        <div class="money_display">{{ ad_requests | list | length }}</div>
                        <h3 class="money_type_title">Total AdRequest</h3>
                    </div>
                </div>
            </div>
            <div class="box1 box" style="width: 230px;">
                <div class="d-flex align-items-center" style="margin-bottom: 0%;">
                    <img src="/static/img/flagged.png" alt="Ad Request" style="height: 35px; margin-right: 10px;">
                    <div class="ml-3 flex-grow-1">
                        <div class="money_display">{{ad_requests | selectattr('flagged', 'equalto', 'True') | list | length }}</div>
                        <h3 class="money_type_title">Flagged AdRequest</h3>
                    </div>
                </div>
            </div>
            <div class="box1 box" style="width: 230px;">
                <div class="d-flex align-items-center" style="margin-bottom: 0%;">
                    <img src="/static/img/approved.png" alt="Ad Request" style="height: 35px; margin-right: 10px;">
                    <div class="ml-3 flex-grow-1">
                        <div class="money_display">{{ad_requests | selectattr('status', 'equalto', 'Approved') | list | length }}</div>
                        <h3 class="money_type_title">Approved AdRequest</h3>
                    </div>
                </div>
            </div>
            <div class="box1 box" style="width: 230px;">
                <div class="d-flex align-items-center" style="margin-bottom: 0%;">
                    <img src="/static/img/pending.png" alt="Ad Request" style="height: 37px; margin-right: 10px;">
                    <div class="ml-3 flex-grow-1">
                        <div class="money_display">{{ad_requests | selectattr('status', 'equalto', 'Pending') | list | length }}</div>
                        <h3 class="money_type_title">Pending AdRequest</h3>
                    </div>
                </div>
            </div>
            <div class="box1 box" style="width: 243px;">
                <div class="d-flex align-items-center" style="margin-bottom: 0%;">
                    <img src="/static/img/rejected.png" alt="Ad Request" style="height: 37px; margin-right: 10px;">
                    <div class="ml-3 flex-grow-1">
                        <div class="money_display">{{ad_requests | selectattr('status', 'equalto', 'Rejected') | list | length }}</div>
                        <h3 class="money_type_title">Rejected AdRequest</h3>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-3" style="width: 100%; height: 20rem;">
            <div class="d-flex justify-content-around align-items-center" style="height: 100%;">
                <div style="width: 39.5%; height: 100%;">
                    <canvas id="adRequestChart" style="width: 100%; height: 100%;"></canvas>
                </div>
                <div style="width: 22.5%; height: 100%;">
                    <canvas id="flaggedAdRequest" style="width: 100%; height: 100%;"></canvas>
                </div>
                <div style="width: 22.5%; height: 100%;">
                    <canvas id="adRequestStatus" style="width: 100%; height: 100%;"></canvas>
                </div>
            </div>
        </div>

    <div class="card">
        <div class="container mt-4 mb-3">
            <ul class="nav nav-pills nav-fill" id="myTab" role="tablist">
                <li class="nav-item short-tab" role="presentation">
                    <button class="nav-link active" id="non-flagged-tab" data-bs-toggle="pill" data-bs-target="#non-flagged" type="button" role="tab" aria-controls="non-flagged" aria-selected="true">Non Flagged Ad Requests</button>
                </li>
                <li class="nav-item short-tab" role="presentation">
                    <button class="nav-link" id="flagged-tab" data-bs-toggle="pill" data-bs-target="#flagged" type="button" role="tab" aria-controls="flagged" aria-selected="false">Flagged Ad Requests</button>
                </li>
            </ul>

            <div class="tab-content mt-4">
                <!-- Non Flagged Ad Request Tab -->
                <div class="tab-pane fade show active" id="non-flagged" role="tabpanel" aria-labelledby="non-flagged-tab">

        <ul class="nav nav-pills nav-fill" id="myTab2" role="tablist">
            <li class="nav-item short-tab" role="presentation">
                <button class="nav-link active" id="approved-tab" data-bs-toggle="pill" data-bs-target="#approved"
                    type="button" role="tab" aria-controls="approved" aria-selected="true">Approved Ad Requests</button>
            </li>
            <li class="nav-item short-tab" role="presentation">
                <button class="nav-link" id="pending-tab" data-bs-toggle="pill" data-bs-target="#pending" type="button"
                    role="tab" aria-controls="pending" aria-selected="false">Pending Ad Requests</button>
            </li>
            <li class="nav-item short-tab" role="presentation">
                <button class="nav-link" id="rejected-tab" data-bs-toggle="pill" data-bs-target="#rejected"
                    type="button" role="tab" aria-controls="rejected" aria-selected="false">Rejected Ad
                    Requests</button>
            </li>
        </ul>
        <div class="tab-content mt-4">
            <!-- Approved Ad Requests Tab -->
            <div class="tab-pane fade show active" id="approved" role="tabpanel" aria-labelledby="approved-tab">
                {% set approved_request = ad_requests | selectattr('status', 'equalto', 'Approved') | first %}
                {% if not approved_request %}
                <div class="d-flex flex-column align-items-center p-4 bg-white shadow-sm rounded">
                    <img src="{{ url_for('static', filename='/img/empty.png') }}" alt="NoctiWave" height="150px">
                    <div class="text-secondary font-weight-bold mb-3 fs-5">
                        No Approved Ad Request Found
                    </div>
                </div>
                {% else %}
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="campaignsTable">
                        <thead class="table-success">
                            <tr>
                                <th scope="col" class="text-center">Ad ID</th>
                                <th scope="col" class="text-center">Campaign Name</th>
                                <th scope="col" class="text-center" style="width: 13%;">Influencer</th>
                                <th scope="col" class="text-center" style="width: 17%;">Sponsor</th>
                                <th scope="col" class="text-center">Requirements</th>
                                <th scope="col" class="text-center">Payment Amount</th>
                                <th scope="col" class="text-center" style="width: 22%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ad_request in ad_requests %}
                            {% if ad_request.status == 'Approved' and ad_request.flagged == 'False' %}
                            <tr>
                                <td class="text-center">{{ ad_request.ad_request_id }}</td>
                                <td class="text-center">{{ ad_request.campaign.name }}</td>
                                <td class="text-center">{{ ad_request.influencer.user.name }}</td>
                                <td class="text-center">{{ ad_request.sponsor.company_individual_name }}</td>
                                <td class="text-center">{{ ad_request.requirements }}</td>
                                <td class="text-center">â‚¹{{ '{:,.2f}'.format(ad_request.payment_amount) }}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm" style="background-color: #00ffff; margin-right: 5px;"
                                        data-bs-toggle="modal"
                                        data-bs-target="#viewAdRequestModal-{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="btn btn-sm btn-warning flagAdRequestLink"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}" style="margin-right: 5px;">
                                        <i class="fas fa-flag"></i> Flag
                                    </button>
                                    <button class="btn btn-sm btn-danger deleteAdRequestLink"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>

            <!-- Pending Ad Requests Tab -->
            <div class="tab-pane fade" id="pending" role="tabpanel" aria-labelledby="pending-tab">
                {% set pending_request = ad_requests | selectattr('status', 'equalto', 'Pending') | first %}
                {% if not pending_request %}
                <div class="d-flex flex-column align-items-center p-4 bg-white shadow-sm rounded">
                    <img src="{{ url_for('static', filename='/img/empty.png') }}" alt="NoctiWave" height="150px">
                    <div class="text-secondary font-weight-bold mb-3 fs-5">
                        No Pending Ad Request Found
                    </div>
                </div>
                {% else %}

                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="campaignsTable">
                        <thead class="table-success">
                            <tr>
                                <th scope="col" class="text-center">Ad ID</th>
                                <th scope="col" class="text-center">Campaign Name</th>
                                <th scope="col" class="text-center" style="width: 13%;">Influencer</th>
                                <th scope="col" class="text-center" style="width: 17%;">Sponsor</th>
                                <th scope="col" class="text-center">Requirements</th>
                                <th scope="col" class="text-center">Payment Amount</th>
                                <th scope="col" class="text-center" style="width: 22%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ad_request in ad_requests %}
                            {% if ad_request.status == 'Pending' and ad_request.flagged == 'False' %}
                            <tr>
                                <td class="text-center">{{ ad_request.ad_request_id }}</td>
                                <td class="text-center">{{ ad_request.campaign.name }}</td>
                                <td class="text-center">{{ ad_request.influencer.user.name }}</td>
                                <td class="text-center">{{ ad_request.sponsor.company_individual_name }}</td>
                                <td class="text-center">{{ ad_request.requirements }}</td>
                                <td class="text-center">â‚¹{{ '{:,.2f}'.format(ad_request.payment_amount) }}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm" style="background-color: #00ffff; margin-right: 5px;"
                                        data-bs-toggle="modal"
                                        data-bs-target="#viewAdRequestModal-{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="btn btn-sm btn-warning flagAdRequestLink"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}" style="margin-right: 5px;">
                                        <i class="fas fa-flag"></i> Flag
                                    </button>
                                    <button class="btn btn-sm btn-danger deleteAdRequestLink"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>


            <!-- Rejected Ad Requests Tab -->
            <div class="tab-pane fade" id="rejected" role="tabpanel" aria-labelledby="rejected-tab">
                {% set rejected_request = ad_requests | selectattr('status', 'equalto', 'Rejected') | first %}
                {% if not rejected_request %}
                <div class="d-flex flex-column align-items-center p-4 bg-white shadow-sm rounded">
                    <img src="{{ url_for('static', filename='/img/empty.png') }}" alt="NoctiWave" height="150px">
                    <div class="text-secondary font-weight-bold mb-3 fs-5">
                        No Rejected Ad Request Found
                    </div>
                </div>
                {% else %}

                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="campaignsTable">
                        <thead class="table-success">
                            <tr>
                                <th scope="col" class="text-center">Ad ID</th>
                                <th scope="col" class="text-center">Campaign Name</th>
                                <th scope="col" class="text-center" style="width: 13%;">Influencer</th>
                                <th scope="col" class="text-center" style="width: 17%;">Sponsor</th>
                                <th scope="col" class="text-center">Requirements</th>
                                <th scope="col" class="text-center">Payment Amount</th>
                                <th scope="col" class="text-center" style="width: 22%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ad_request in ad_requests %}
                            {% if ad_request.status == 'Rejected' and ad_request.flagged == 'False' %}
                            <tr>
                                <td class="text-center">{{ ad_request.ad_request_id }}</td>
                                <td class="text-center">{{ ad_request.campaign.name }}</td>
                                <td class="text-center">{{ ad_request.influencer.user.name }}</td>
                                <td class="text-center">{{ ad_request.sponsor.company_individual_name }}</td>
                                <td class="text-center">{{ ad_request.requirements }}</td>
                                <td class="text-center">â‚¹{{ '{:,.2f}'.format(ad_request.payment_amount) }}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm" style="background-color: #00ffff; margin-right: 5px;"
                                        data-bs-toggle="modal"
                                        data-bs-target="#viewAdRequestModal-{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="btn btn-sm btn-warning flagAdRequestLink"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}" style="margin-right: 5px;">
                                        <i class="fas fa-flag"></i> Flag
                                    </button>
                                    <button class="btn btn-sm btn-danger deleteAdRequestLink"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>



            {% for ad_request in ad_requests %}
            <!-- View Ad Request Modal -->
            <div class="modal fade" id="viewAdRequestModal-{{ ad_request.ad_request_id }}" tabindex="-1"
                aria-labelledby="viewAdRequestModalLabel-{{ ad_request.ad_request_id }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="viewAdRequestModalLabel-{{ ad_request.ad_request_id }}">Ad
                                Request Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p><strong>Ad Request ID:</strong> {{ ad_request.ad_request_id }}</p>
                            <p><strong>Campaign:</strong> {{ ad_request.campaign.name }}</p>
                            <p><strong>Influencer:</strong> {{ ad_request.influencer.user.name }}</p>
                            <p><strong>Sponsor:</strong> {{ ad_request.sponsor.company_individual_name }}</p>
                            <p><strong>Flagged:</strong> {{ ad_request.flagged }}</p>
                            <p><strong>Initiator:</strong> {{ ad_request.initiator }}</p>
                            <p><strong>Requirements:</strong> {{ ad_request.requirements }}</p>
                            <p><strong>Payment Amount:</strong> â‚¹{{ '{:,.2f}'.format(ad_request.payment_amount) }}</p>
                            <p><strong>Status:</strong> {{ ad_request.status }}</p>
                            <p><strong>Messages:</strong> {{ ad_request.messages }}</p>
                            <!-- Add more details as needed -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flag Ad Request Modal -->
            <div class="modal fade" id="flagAdRequestModal-{{ ad_request.ad_request_id }}" tabindex="-1"
                aria-labelledby="flagAdRequestModalLabel-{{ ad_request.ad_request_id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="flagAdRequestModalLabel-{{ ad_request.ad_request_id }}">Confirm
                                Flag Ad Request</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to flag the ad request for "{{ ad_request.campaign.name }}"?
                        </div>
                        <div class="modal-footer">
                            <form method="POST">
                                <input type="hidden" name="_method" value="FLAG">
                                <input type="hidden" name="ad_request_id" value="{{ ad_request.ad_request_id }}">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-warning">Yes, Flag</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delete Ad Request Modal -->
            <div class="modal fade" id="deleteAdRequestModal-{{ ad_request.ad_request_id }}" tabindex="-1"
                aria-labelledby="deleteAdRequestModalLabel-{{ ad_request.ad_request_id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteAdRequestModalLabel-{{ ad_request.ad_request_id }}">
                                Confirm Delete Ad Request</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete the ad request for "{{ ad_request.campaign.name }}" by "{{
                            ad_request.influencer.name }}"?
                        </div>
                        <div class="modal-footer">
                            <form method="POST">
                                <input type="hidden" name="_method" value="DELETE">
                                <input type="hidden" name="ad_request_id" value="{{ ad_request.ad_request_id }}">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                                <button type="submit" class="btn btn-danger">Yes, Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Flagged Campaign Tab -->
    <div class="tab-pane fade" id="flagged" role="tabpanel" aria-labelledby="flagged-tab">
        <ul class="nav nav-pills nav-fill" id="myTab3" role="tablist">
            <li class="nav-item short-tab" role="presentation">
                <button class="nav-link active" id="approved-tab2" data-bs-toggle="pill" data-bs-target="#approved2"
                    type="button" role="tab" aria-controls="approved2" aria-selected="true">Approved Ad Requests</button>
            </li>
            <li class="nav-item short-tab" role="presentation">
                <button class="nav-link" id="pending-tab2" data-bs-toggle="pill" data-bs-target="#pending2" type="button"
                    role="tab" aria-controls="pending2" aria-selected="false">Pending Ad Requests</button>
            </li>
            <li class="nav-item short-tab" role="presentation">
                <button class="nav-link" id="rejected-tab2" data-bs-toggle="pill" data-bs-target="#rejected2"
                    type="button" role="tab" aria-controls="rejected2" aria-selected="false">Rejected Ad
                    Requests</button>
            </li>
        </ul>
        <div class="tab-content mt-4">
            <!-- Approved Ad Requests Tab -->
            <div class="tab-pane fade show active" id="approved2" role="tabpanel" aria-labelledby="approved-tab2">
                {% set approved_request = ad_requests | selectattr('status', 'equalto', 'Approved') | first %}
                {% if not approved_request %}
                <div class="d-flex flex-column align-items-center p-4 bg-white shadow-sm rounded">
                    <img src="{{ url_for('static', filename='/img/empty.png') }}" alt="NoctiWave" height="150px">
                    <div class="text-secondary font-weight-bold mb-3 fs-5">
                        No Approved Ad Request Found
                    </div>
                </div>
                {% else %}
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="campaignsTable">
                        <thead class="table-success">
                            <tr>
                                <th scope="col" class="text-center">Ad ID</th>
                                <th scope="col" class="text-center">Campaign Name</th>
                                <th scope="col" class="text-center" style="width: 13%;">Influencer</th>
                                <th scope="col" class="text-center" style="width: 17%;">Sponsor</th>
                                <th scope="col" class="text-center">Requirements</th>
                                <th scope="col" class="text-center">Payment Amount</th>
                                <th scope="col" class="text-center" style="width: 22%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ad_request in ad_requests %}
                            {% if ad_request.status == 'Approved' and ad_request.flagged == 'True' %}
                            <tr>
                                <td class="text-center">{{ ad_request.ad_request_id }}</td>
                                <td class="text-center">{{ ad_request.campaign.name }}</td>
                                <td class="text-center">{{ ad_request.influencer.user.name }}</td>
                                <td class="text-center">{{ ad_request.sponsor.company_individual_name }}</td>
                                <td class="text-center">{{ ad_request.requirements }}</td>
                                <td class="text-center">â‚¹{{ '{:,.2f}'.format(ad_request.payment_amount) }}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm" style="background-color: #00ffff; margin-right: 5px;"
                                        data-bs-toggle="modal-copy"
                                        data-bs-target="#viewAdRequestModalCopy-{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="btn btn-sm btn-warning unflagAdRequestLink"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}" style="margin-right: 5px;">
                                        <i class="fas fa-minus-circle"></i> Unflag
                                    </button>
                                    <button class="btn btn-sm btn-danger deleteAdRequestLinkCopy"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>

            <!-- Pending Ad Requests Tab -->
            <div class="tab-pane fade" id="pending2" role="tabpanel" aria-labelledby="pending-tab2">
                {% set pending_request = ad_requests | selectattr('status', 'equalto', 'Pending') | first %}
                {% if not pending_request %}
                <div class="d-flex flex-column align-items-center p-4 bg-white shadow-sm rounded">
                    <img src="{{ url_for('static', filename='/img/empty.png') }}" alt="NoctiWave" height="150px">
                    <div class="text-secondary font-weight-bold mb-3 fs-5">
                        No Pending Ad Request Found
                    </div>
                </div>
                {% else %}

                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="campaignsTable">
                        <thead class="table-success">
                            <tr>
                                <th scope="col" class="text-center">Ad ID</th>
                                <th scope="col" class="text-center">Campaign Name</th>
                                <th scope="col" class="text-center" style="width: 13%;">Influencer</th>
                                <th scope="col" class="text-center" style="width: 17%;">Sponsor</th>
                                <th scope="col" class="text-center">Requirements</th>
                                <th scope="col" class="text-center">Payment Amount</th>
                                <th scope="col" class="text-center" style="width: 22%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ad_request in ad_requests %}
                            {% if ad_request.status == 'Pending' and ad_request.flagged == 'True' %}
                            <tr>
                                <td class="text-center">{{ ad_request.ad_request_id }}</td>
                                <td class="text-center">{{ ad_request.campaign.name }}</td>
                                <td class="text-center">{{ ad_request.influencer.user.name }}</td>
                                <td class="text-center">{{ ad_request.sponsor.company_individual_name }}</td>
                                <td class="text-center">{{ ad_request.requirements }}</td>
                                <td class="text-center">â‚¹{{ '{:,.2f}'.format(ad_request.payment_amount) }}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm" style="background-color: #00ffff; margin-right: 5px;"
                                        data-bs-toggle="modal-copy"
                                        data-bs-target="#viewAdRequestModalCopy-{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="btn btn-sm btn-warning unflagAdRequestLink"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}" style="margin-right: 5px;">
                                        <i class="fas fa-minus-circle"></i> Unflag
                                    </button>
                                    <button class="btn btn-sm btn-danger deleteAdRequestLinkCopy"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>


            <!-- Rejected Ad Requests Tab -->
            <div class="tab-pane fade" id="rejected2" role="tabpanel" aria-labelledby="rejected-tab2">
                {% set rejected_request = ad_requests | selectattr('status', 'equalto', 'Rejected') | first %}
                {% if not rejected_request %}
                <div class="d-flex flex-column align-items-center p-4 bg-white shadow-sm rounded">
                    <img src="{{ url_for('static', filename='/img/empty.png') }}" alt="NoctiWave" height="150px">
                    <div class="text-secondary font-weight-bold mb-3 fs-5">
                        No Rejected Ad Request Found
                    </div>
                </div>
                {% else %}

                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="campaignsTable">
                        <thead class="table-success">
                            <tr>
                                <th scope="col" class="text-center">Ad ID</th>
                                <th scope="col" class="text-center">Campaign Name</th>
                                <th scope="col" class="text-center" style="width: 13%;">Influencer</th>
                                <th scope="col" class="text-center" style="width: 17%;">Sponsor</th>
                                <th scope="col" class="text-center">Requirements</th>
                                <th scope="col" class="text-center">Payment Amount</th>
                                <th scope="col" class="text-center" style="width: 22%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ad_request in ad_requests %}
                            {% if ad_request.status == 'Rejected' and ad_request.flagged == 'True' %}
                            <tr>
                                <td class="text-center">{{ ad_request.ad_request_id }}</td>
                                <td class="text-center">{{ ad_request.campaign.name }}</td>
                                <td class="text-center">{{ ad_request.influencer.user.name }}</td>
                                <td class="text-center">{{ ad_request.sponsor.company_individual_name }}</td>
                                <td class="text-center">{{ ad_request.requirements }}</td>
                                <td class="text-center">â‚¹{{ '{:,.2f}'.format(ad_request.payment_amount) }}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm" style="background-color: #00ffff; margin-right: 5px;"
                                    data-bs-toggle="modal-copy"
                                    data-bs-target="#viewAdRequestModalCopy-{{ ad_request.ad_request_id }}">
                                    <i class="fas fa-eye"></i> View 
                                    </button>
                                    <button class="btn btn-sm btn-warning unflagAdRequestLink"
                                    data-ad-request-id="{{ ad_request.ad_request_id }}" style="margin-right: 5px;">
                                    <i class="fas fa-minus-circle"></i> Unflag
                                </button>
                                    <button class="btn btn-sm btn-danger deleteAdRequestLinkCopy"
                                        data-ad-request-id="{{ ad_request.ad_request_id }}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>



            {% for ad_request in ad_requests %}
            <!-- View Ad Request Modal -->
            <div class="modal fade" id="viewAdRequestModalCopy-{{ ad_request.ad_request_id }}" tabindex="-1"
            aria-labelledby="viewAdRequestModalLabelCopy-{{ ad_request.ad_request_id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="viewAdRequestModalLabelCopy-{{ ad_request.ad_request_id }}">Ad Request Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Ad Request ID:</strong> {{ ad_request.ad_request_id }}</p>
                        <p><strong>Campaign:</strong> {{ ad_request.campaign.name }}</p>
                        <p><strong>Influencer:</strong> {{ ad_request.influencer.user.name }}</p>
                        <p><strong>Sponsor:</strong> {{ ad_request.sponsor.company_individual_name }}</p>
                        <p><strong>Flagged:</strong> {{ ad_request.flagged }}</p>
                        <p><strong>Initiator:</strong> {{ ad_request.initiator }}</p>
                        <p><strong>Requirements:</strong> {{ ad_request.requirements }}</p>
                        <p><strong>Payment Amount:</strong> â‚¹{{ '{:,.2f}'.format(ad_request.payment_amount) }}</p>
                        <p><strong>Status:</strong> {{ ad_request.status }}</p>
                        <p><strong>Messages:</strong> {{ ad_request.messages }}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
            <!-- Unflag Ad Request Modal -->
            <div class="modal fade" id="unflagAdRequestModal-{{ ad_request.ad_request_id }}" tabindex="-1"
                aria-labelledby="unflagAdRequestModalLabel-{{ ad_request.ad_request_id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="unflagAdRequestModalLabel-{{ ad_request.ad_request_id }}">
                                Confirm Unflag Ad Request</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to unflag the ad request for <strong>{{ ad_request.campaign.name }}</strong>?
                        </div>
                        <div class="modal-footer">
                            <form method="POST">
                                <input type="hidden" name="_method" value="UNFLAG">
                                <input type="hidden" name="ad_request_id" value="{{ ad_request.ad_request_id }}">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-warning">Yes, Unflag</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delete Ad Request Modal -->
            <div class="modal fade" id="deleteAdRequestModalCopy-{{ ad_request.ad_request_id }}" tabindex="-1"
            aria-labelledby="deleteAdRequestModalLabelCopy-{{ ad_request.ad_request_id }}" aria-hidden="true">
           <div class="modal-dialog">
               <div class="modal-content">
                   <div class="modal-header">
                       <h5 class="modal-title" id="deleteAdRequestModalLabelCopy-{{ ad_request.ad_request_id }}">
                           Confirm Delete Ad Request
                       </h5>
                       <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                   </div>
                   <div class="modal-body">
                       Are you sure you want to delete the ad request for <strong>{{ ad_request.campaign.name }}</strong>?
                   </div>
                   <div class="modal-footer">
                       <form method="POST">
                           <input type="hidden" name="_method" value="DELETE">
                           <input type="hidden" name="ad_request_id" value="{{ ad_request.ad_request_id }}">
                           <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                           <button type="submit" class="btn btn-danger">Yes, Delete</button>
                       </form>
                   </div>
               </div>
           </div>
       </div>
       
            {% endfor %}
        </div>
    </div>
</div>
</div>
</div>
    <script>
        var chartData12 = JSON.parse('{{ ad_distribution_chart | tojson | safe }}');
        var chartData13 = JSON.parse('{{ flagged_ad_chart | tojson | safe }}');    
        var chartData14 = JSON.parse('{{ ad_status_chart | tojson | safe }}');     
    </script>
{% endblock %}